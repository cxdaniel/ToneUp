# æœ‰é“æ™ºäº‘APIé…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ToneUpå·²æ”¹ç”¨**æœ‰é“æ™ºäº‘API**ä½œä¸ºè¯å…¸æ•°æ®æºï¼Œæä¾›ä¸“ä¸šçš„æ±‰è‹±ç¿»è¯‘å’Œè¯å…¸åŠŸèƒ½ã€‚

**å½“å‰è¯å…¸æ¶æ„**ï¼š
```
L1: LRUå†…å­˜ç¼“å­˜ (200è¯ä¸Šé™) â†’ å¾®ç§’çº§å“åº”
L2: SQLiteæœ¬åœ°ç¼“å­˜ â†’ æ¯«ç§’çº§å“åº”  
L3: Supabaseäº‘ç«¯æ•°æ®åº“ â†’ 100-300ms
L4: æœ‰é“æ™ºäº‘API â†’ 1-2ç§’
L5: æ‹¼éŸ³é™çº§ â†’ æœ€ç»ˆå…œåº•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿï¼‰

### 1. æ³¨å†Œæœ‰é“æ™ºäº‘è´¦å·

è®¿é—®ï¼šhttps://ai.youdao.com/

- ç‚¹å‡»"å…è´¹æ³¨å†Œ"
- ä½¿ç”¨æ‰‹æœºå·æˆ–é‚®ç®±æ³¨å†Œ
- å®Œæˆå®åè®¤è¯ï¼ˆå¿…éœ€ï¼‰

### 2. åˆ›å»ºåº”ç”¨è·å–APIå¯†é’¥

1. **ç™»å½•æ§åˆ¶å°**: https://ai.youdao.com/console/
2. **åˆ›å»ºåº”ç”¨**:
   - è¿›å…¥"åº”ç”¨ç®¡ç†" â†’ "æˆ‘çš„åº”ç”¨"
   - ç‚¹å‡»"åˆ›å»ºåº”ç”¨"
   - åº”ç”¨åç§°ï¼š`ToneUp Chinese Learning`
   - æ¥å…¥æ–¹å¼ï¼šé€‰æ‹©"API"
   - åº”ç”¨ç±»åˆ«ï¼šé€‰æ‹©"æ•™è‚²å­¦ä¹ "
   - æäº¤åˆ›å»º

3. **è·å–å¯†é’¥**:
   - åœ¨åº”ç”¨åˆ—è¡¨ä¸­æ‰¾åˆ°åˆšåˆ›å»ºçš„åº”ç”¨
   - å¤åˆ¶ **åº”ç”¨ID** (APP_KEY)
   - å¤åˆ¶ **åº”ç”¨å¯†é’¥** (APP_SECRET)

### 3. é…ç½®åˆ°ä»£ç ä¸­

æ‰“å¼€ `lib/services/youdao_api_service.dart`ï¼š

```dart
// æ‰¾åˆ°è¿™ä¸¤è¡Œï¼ˆç¬¬13-14è¡Œï¼‰
static const String _appKey = 'YOUR_YOUDAO_APP_KEY';
static const String _appSecret = 'YOUR_YOUDAO_APP_SECRET';

// æ›¿æ¢ä¸ºä½ çš„å®é™…å¯†é’¥
static const String _appKey = 'ä½ çš„åº”ç”¨ID';  // ä¾‹å¦‚: '5a1b2c3d4e5f6789'
static const String _appSecret = 'ä½ çš„åº”ç”¨å¯†é’¥';  // ä¾‹å¦‚: 'ABCDefgh123456'
```

**âš ï¸ é‡è¦æç¤º**ï¼š
- å¯†é’¥æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦æäº¤åˆ°å…¬å¼€çš„Gitä»“åº“
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥

### 4. æµ‹è¯•APIé…ç½®

è¿è¡Œåº”ç”¨åå¯¼èˆªåˆ°è¯å…¸è°ƒè¯•é¡µé¢ï¼š

```bash
flutter run
# åº”ç”¨ä¸­è®¿é—®è·¯ç”±: /dictionary-debug
```

åœ¨è°ƒè¯•é¡µé¢ä¸­ï¼š
1. æŸ¥çœ‹"L4 æœ‰é“æ™ºäº‘API"çŠ¶æ€ â†’ åº”æ˜¾ç¤º"APIå·²é…ç½®" âœ…
2. ç‚¹å‡»"æ¸…ç©ºæœ¬åœ°ç¼“å­˜"
3. è¾“å…¥æµ‹è¯•è¯è¯­ï¼ˆä¾‹å¦‚"ä½ å¥½"ï¼‰
4. ç‚¹å‡»"æ‰§è¡Œæµ‹è¯•"
5. æŸ¥çœ‹ç»“æœ â†’ åº”æ˜¾ç¤º"APIè¯å…¸å·¥ä½œæ­£å¸¸" âœ…

## ğŸ’° è´¹ç”¨è¯´æ˜

### å…è´¹é¢åº¦
- **æ–°ç”¨æˆ·èµ é€**: 100å…ƒä½“éªŒé‡‘
- **æ¯æ—¥å…è´¹**: 100æ¬¡ç¿»è¯‘è¯·æ±‚
- **æŒ‰é‡è®¡è´¹**: 48å…ƒ/ç™¾ä¸‡å­—ç¬¦ï¼ˆçº¦0.05å…ƒ/åƒå­—ç¬¦ï¼‰

### æˆæœ¬ä¼°ç®—ï¼ˆä»¥100ä¸‡å­—ç¬¦ä¸ºä¾‹ï¼‰

| ç”¨æˆ·è§„æ¨¡ | æ¯æ—¥æŸ¥è¯¢é‡ | æœˆåº¦æˆæœ¬ | è¯´æ˜ |
|---------|----------|---------|------|
| 100äºº | 1000è¯ | ~0å…ƒ | å…è´¹é¢åº¦è¶³å¤Ÿ |
| 1000äºº | 10000è¯ | ~15å…ƒ | 30ä¸‡å­—ç¬¦/æœˆ |
| 10000äºº | 100000è¯ | ~150å…ƒ | 300ä¸‡å­—ç¬¦/æœˆ |

**å®é™…æˆæœ¬ä¼šæ›´ä½**ï¼Œå› ä¸ºï¼š
- L1-L3ç¼“å­˜å‘½ä¸­ç‡ > 80%ï¼ˆå¤ä¹ åœºæ™¯ï¼‰
- åªæœ‰æ–°è¯æŸ¥è¯¢æ‰ä¼šè°ƒç”¨API
- Supabaseè·¨ç”¨æˆ·å…±äº«è¯å…¸æ•°æ®

## ğŸ”§ é«˜çº§é…ç½®

### ä¿®æ”¹APIè¯·æ±‚å‚æ•°

åœ¨ `youdao_api_service.dart` ä¸­ä¿®æ”¹ç¿»è¯‘å‚æ•°ï¼š

```dart
Future<WordDetailModel?> translate({
  required String word,
  String from = 'zh-CHS',  // æºè¯­è¨€ï¼šzh-CHS(ç®€ä½“ä¸­æ–‡), zh-CHT(ç¹ä½“ä¸­æ–‡)
  String to = 'en',        // ç›®æ ‡è¯­è¨€ï¼šen(è‹±è¯­), ja(æ—¥è¯­), ko(éŸ©è¯­), fr(æ³•è¯­)
}) async {
  // ...
}
```

### æ”¯æŒçš„è¯­è¨€ä»£ç 

| è¯­è¨€ | ä»£ç  | è¯´æ˜ |
|-----|-----|-----|
| ç®€ä½“ä¸­æ–‡ | zh-CHS | é»˜è®¤æºè¯­è¨€ |
| è‹±è¯­ | en | é»˜è®¤ç›®æ ‡è¯­è¨€ |
| æ—¥è¯­ | ja | æ—¥æ–‡å­¦ä¹ åœºæ™¯ |
| éŸ©è¯­ | ko | éŸ©æ–‡å­¦ä¹ åœºæ™¯ |
| æ³•è¯­ | fr | æ³•æ–‡å­¦ä¹ åœºæ™¯ |
| è¥¿ç­ç‰™è¯­ | es | è¥¿ç­ç‰™è¯­åœºæ™¯ |

### è°ƒæ•´è¯·æ±‚é™æµ

é»˜è®¤æ¯ç§’æœ€å¤š10æ¬¡è¯·æ±‚ï¼Œä¿®æ”¹æ‰¹é‡ç¿»è¯‘é™æµï¼š

```dart
Future<Map<String, WordDetailModel?>> translateBatch(
  List<String> words,
) async {
  for (var word in words) {
    results[word] = await translate(word: word);
    
    // ä¿®æ”¹è¿™é‡Œçš„å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    await Future.delayed(const Duration(milliseconds: 100));  // 10 QPS
    // æ”¹ä¸º 50ms = 20 QPSï¼ˆéœ€è¦ä»˜è´¹å¥—é¤ï¼‰
  }
}
```

## ğŸ“Š ç›‘æ§ä¸è°ƒè¯•

### æŸ¥çœ‹APIè°ƒç”¨ç»Ÿè®¡

åœ¨ä»£ç ä¸­è°ƒç”¨ï¼š

```dart
final stats = YoudaoApiService().getUsageStats();
print('APIé…ç½®çŠ¶æ€: ${stats['configured']}');
print('APP_KEY: ${stats['app_key']}');
```

### æŸ¥çœ‹ç¼“å­˜å‘½ä¸­ç‡

```dart
final cacheStats = await SimpleDictionaryService().getCacheStats();
print('LRUç¼“å­˜: ${cacheStats['lru']}');
print('SQLiteç¼“å­˜: ${cacheStats['sqlite']}');
print('APIçŠ¶æ€: ${cacheStats['youdao_api']}');
```

### æµ‹è¯•APIè°ƒç”¨

```dart
final testResult = await SimpleDictionaryService().testApiDictionary(
  testWord: 'å­¦ä¹ ',
);

if (testResult['success'] == true) {
  print('âœ… APIå·¥ä½œæ­£å¸¸');
  print('æŸ¥è¯¢è€—æ—¶: ${testResult['query_time_ms']}ms');
  print('é‡Šä¹‰: ${testResult['summary']}');
} else {
  print('âŒ APIæµ‹è¯•å¤±è´¥: ${testResult['error']}');
}
```

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆä¸æäº¤åˆ°Gitï¼‰ï¼š

```env
YOUDAO_APP_KEY=your_actual_app_key
YOUDAO_APP_SECRET=your_actual_app_secret
```

åœ¨ä»£ç ä¸­è¯»å–ï¼š

```dart
import 'package:flutter_dotenv/flutter_dotenv.dart';

await dotenv.load();  // main() ä¸­è°ƒç”¨

static final String _appKey = dotenv.env['YOUDAO_APP_KEY'] ?? '';
static final String _appSecret = dotenv.env['YOUDAO_APP_SECRET'] ?? '';
```

### 2. æ·»åŠ è¯·æ±‚ç­¾åéªŒè¯

æœ‰é“APIå·²å†…ç½®ç­¾åéªŒè¯ï¼Œ`_generateSign()` æ–¹æ³•è‡ªåŠ¨å¤„ç†ï¼š

```dart
String _generateSign(String query, String salt, String curtime) {
  final input = query.length <= 20 
      ? query 
      : query.substring(0, 10) + query.length.toString() + query.substring(query.length - 10);
  
  final signStr = '$_appKey$input$salt$curtime$_appSecret';
  return sha256.convert(utf8.encode(signStr)).toString();
}
```

### 3. IPç™½åå•è®¾ç½®ï¼ˆå¯é€‰ï¼‰

åœ¨æœ‰é“æ§åˆ¶å° â†’ åº”ç”¨ç®¡ç† â†’ IPç™½åå•ï¼š
- æ·»åŠ æœåŠ¡å™¨IPåœ°å€
- é™åˆ¶ä»…å…è®¸æŒ‡å®šIPè°ƒç”¨API

## â“ å¸¸è§é—®é¢˜

### Q: APIè°ƒç”¨å¤±è´¥ï¼Œè¿”å›é”™è¯¯ç ï¼Ÿ

**é”™è¯¯ç å‚è€ƒ**ï¼š

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|-------|-----|---------|
| 101 | ç¼ºå°‘å¿…å¡«å‚æ•° | æ£€æŸ¥APP_KEYé…ç½® |
| 102 | ä¸æ”¯æŒçš„è¯­è¨€ç±»å‹ | æ£€æŸ¥from/toå‚æ•° |
| 103 | ç¿»è¯‘æ–‡æœ¬è¿‡é•¿ | å•æ¬¡æœ€å¤š5000å­—ç¬¦ |
| 108 | åº”ç”¨IDæ— æ•ˆ | æ£€æŸ¥APP_KEYæ˜¯å¦æ­£ç¡® |
| 202 | ç­¾åæ£€éªŒå¤±è´¥ | æ£€æŸ¥APP_SECRETæ˜¯å¦æ­£ç¡® |
| 401 | è´¦æˆ·å·²æ¬ è´¹ | å……å€¼è´¦æˆ·ä½™é¢ |
| 411 | è®¿é—®é¢‘ç‡å—é™ | é™ä½è¯·æ±‚é¢‘ç‡æˆ–å‡çº§å¥—é¤ |

å®Œæ•´é”™è¯¯ç ï¼šhttps://ai.youdao.com/DOCSIRMA/html/trans/api/wbfy/index.html#section-11

### Q: å¦‚ä½•æŸ¥çœ‹APIæ¶ˆè´¹æƒ…å†µï¼Ÿ

ç™»å½•æ§åˆ¶å° â†’ è´¢åŠ¡ç®¡ç† â†’ æ¶ˆè´¹æ˜ç»†ï¼š
- æŸ¥çœ‹æ¯æ—¥è°ƒç”¨é‡
- æŸ¥çœ‹å­—ç¬¦æ¶ˆè€—æ•°
- å¯¼å‡ºè´¦å•æ˜ç»†

### Q: å…è´¹é¢åº¦ç”¨å®Œåæ€ä¹ˆåŠï¼Ÿ

1. **å……å€¼è´¦æˆ·**: æœ€ä½å……å€¼50å…ƒ
2. **é™ä½è°ƒç”¨é¢‘ç‡**: æé«˜ç¼“å­˜å‘½ä¸­ç‡
3. **åˆ‡æ¢åˆ°å¤‡ç”¨æ–¹æ¡ˆ**: æš‚æ—¶ä½¿ç”¨æ‹¼éŸ³é™çº§

### Q: å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ

- **L1 LRUç¼“å­˜**: è‡ªåŠ¨ç¼“å­˜æœ€è¿‘200è¯
- **L2 SQLite**: æŒä¹…åŒ–æœ¬åœ°è¯å…¸
- **L3 Supabase**: è·¨ç”¨æˆ·å…±äº«è¯å…¸ï¼ˆç”¨æˆ·AæŸ¥è¿‡çš„è¯ï¼Œç”¨æˆ·Bç›´æ¥å‘½ä¸­ï¼‰
- å¤ä¹ åœºæ™¯ç¼“å­˜å‘½ä¸­ç‡ > 90%

### Q: Webç«¯æ”¯æŒå—ï¼Ÿ

å®Œå…¨æ”¯æŒï¼LRUç¼“å­˜å’ŒAPIè°ƒç”¨åœ¨Web/ç§»åŠ¨ç«¯é€šç”¨ï¼š
- **ç§»åŠ¨ç«¯**: SQLiteæŒä¹…åŒ–ç¼“å­˜
- **Webç«¯**: IndexedDBæŒä¹…åŒ–ç¼“å­˜
- **è·¨å¹³å°**: Supabaseäº‘ç«¯åŒæ­¥

## ğŸ“š APIæ–‡æ¡£

- **å®˜æ–¹æ–‡æ¡£**: https://ai.youdao.com/DOCSIRMA/html/trans/api/wbfy/index.html
- **æ§åˆ¶å°**: https://ai.youdao.com/console/
- **ä»·æ ¼è¯´æ˜**: https://ai.youdao.com/product-fanyi-text.s

## ğŸ†˜ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æ£€æŸ¥æ—¥å¿—**: è¿è¡Œ `flutter run` æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
2. **ä½¿ç”¨è°ƒè¯•é¡µé¢**: è®¿é—® `/dictionary-debug` æµ‹è¯•é…ç½®
3. **æŸ¥çœ‹é”™è¯¯ç **: å‚è€ƒä¸Šæ–¹"é”™è¯¯ç å‚è€ƒ"è¡¨æ ¼
4. **è”ç³»æœ‰é“å®¢æœ**: https://ai.youdao.com/ å³ä¸‹è§’å®¢æœæŒ‰é’®

---

**æœ€åæ›´æ–°**: 2026-01-25  
**å½“å‰ç‰ˆæœ¬**: 1.0.0 (æœ‰é“APIæ–¹æ¡ˆ)
